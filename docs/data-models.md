# HFT Arbitrage Bot - Data Models Reference

> **Auto-generated by document-project workflow**

---

## Core Types

### Orderbook

```rust
pub struct Orderbook {
    pub bids: Vec<OrderbookLevel>,  // Highest first
    pub asks: Vec<OrderbookLevel>,  // Lowest first
    pub timestamp: u64,              // Unix ms
}

pub struct OrderbookLevel {
    pub price: f64,
    pub quantity: f64,
}
```

**Methods:**
- `new()` → Empty orderbook with current timestamp
- `best_bid()` → `Option<f64>` highest bid price
- `best_ask()` → `Option<f64>` lowest ask price
- `mid_price()` → `Option<f64>` average of best bid/ask
- `spread()` → `Option<f64>` ask - bid
- `total_bid_volume()` / `total_ask_volume()` → Sum of quantities

---

### Order Types

```rust
pub struct OrderRequest {
    pub client_order_id: String,
    pub symbol: String,
    pub side: OrderSide,
    pub order_type: OrderType,
    pub price: Option<f64>,        // Required for Limit
    pub quantity: f64,
    pub time_in_force: TimeInForce,
}

pub struct OrderResponse {
    pub order_id: String,          // Exchange-assigned
    pub client_order_id: String,
    pub status: OrderStatus,
    pub filled_quantity: f64,
    pub avg_price: Option<f64>,
}
```

**Enums:**
```rust
pub enum OrderSide { Buy, Sell }
pub enum OrderType { Market, Limit }
pub enum TimeInForce { Gtc, Ioc, Fok }
pub enum OrderStatus { Pending, Open, PartiallyFilled, Filled, Cancelled, Rejected }
```

---

### Connection Health

```rust
pub struct ConnectionHealth {
    state: RwLock<ConnectionState>,
    last_pong: AtomicU64,    // Unix ms of last pong
    last_data: AtomicU64,    // Unix ms of last market data
}

pub enum ConnectionState {
    Disconnected,
    Connecting,
    Connected,
    Degraded,  // Connected but no recent data
}
```

**Health Check (10s threshold):**
```rust
pub fn check_health(&self) -> ConnectionState {
    if now - last_data > STALE_DATA_THRESHOLD_MS {
        ConnectionState::Degraded
    } else {
        ConnectionState::Connected
    }
}
```

---

### Spread Types

```rust
pub enum SpreadDirection {
    AOverB,  // Buy A, Sell B
    BOverA,  // Buy B, Sell A
}

pub struct SpreadResult {
    pub spread_pct: f64,           // Positive = opportunity
    pub direction: SpreadDirection,
    pub ask_price: f64,            // Buying exchange
    pub bid_price: f64,            // Selling exchange  
    pub midpoint: f64,
    pub timestamp_ms: u64,
}

pub struct SpreadTick {
    pub pair: String,        // e.g., "BTC-PERP"
    pub dex_a: String,       // e.g., "vest"
    pub dex_b: String,       // e.g., "paradex"
    pub result: SpreadResult,
}
```

---

### VWAP Result

```rust
pub struct VwapResult {
    pub vwap_price: f64,       // Volume-weighted average
    pub total_quantity: f64,   // Amount filled
    pub slippage_bps: f64,     // Basis points from best
    pub levels_consumed: usize,
    pub best_price: f64,       // Reference price
}
```

**Slippage Check:**
```rust
pub fn is_slippage_acceptable(&self, threshold_bps: f64) -> bool {
    self.slippage_bps.abs() <= threshold_bps
}
```

---

### Position Info

```rust
pub struct PositionInfo {
    pub symbol: String,
    pub side: OrderSide,
    pub size: f64,               // Absolute position size
    pub entry_price: f64,
    pub unrealized_pnl: f64,
    pub liquidation_price: Option<f64>,
}
```

---

## Configuration Types

### AppConfig

```rust
pub struct AppConfig {
    pub bots: Vec<BotConfig>,
    pub risk: RiskConfig,
    pub api: ApiConfig,
}

pub struct BotConfig {
    pub id: String,              // Unique identifier
    pub pair: TradingPair,       // BTC-PERP, ETH-PERP, SOL-PERP
    pub dex_a: Dex,              // vest, paradex, hyperliquid, lighter
    pub dex_b: Dex,
    pub spread_entry: f64,       // Entry threshold %
    pub spread_exit: f64,        // Exit threshold %
    pub leverage: u8,            // 1-100
    pub capital: f64,            // USD
}

pub struct RiskConfig {
    pub adl_warning: f64,        // % distance from liquidation
    pub adl_critical: f64,       // Triggers position reduction
    pub max_duration_hours: u32,
}

pub struct ApiConfig {
    pub port: u16,
    pub ws_heartbeat_sec: u32,
}
```

---

## State Types

### Application State

```rust
pub type SharedAppState = Arc<RwLock<AppState>>;

pub struct AppState {
    pub bots: HashMap<String, BotState>,
    pub metrics: Metrics,
    pub config: AppConfig,
    pub start_time_ms: u64,
}

pub struct BotState {
    pub config: BotConfig,
    pub status: BotStatus,
    pub last_update_ms: u64,
}

pub enum BotStatus {
    Stopped,    // Default
    Starting,
    Trading,
    Recovering,
    Error,
}

pub struct Metrics {
    pub total_trades: u64,
    pub total_pnl: f64,
    pub active_positions: usize,
    pub uptime_seconds: u64,
}
```

---

## Channel Types

```rust
pub struct SpreadOpportunity {
    pub pair: String,
    pub dex_a: String,
    pub dex_b: String,
    pub spread_percent: f64,
    pub direction: SpreadDirection,
    pub detected_at_ms: u64,
}

pub struct ChannelBundle {
    pub opportunity_tx: mpsc::Sender<SpreadOpportunity>,
    pub opportunity_rx: mpsc::Receiver<SpreadOpportunity>,
    pub shutdown_tx: broadcast::Sender<()>,
}
```

---

## Error Types

### AppError

```rust
pub enum AppError {
    Config(String),
    Exchange(ExchangeError),
    WebSocket(tokio_tungstenite::tungstenite::Error),
    Io(std::io::Error),
}
```

### ExchangeError

```rust
pub enum ExchangeError {
    ConnectionFailed(String),
    AuthenticationFailed(String),
    SubscriptionFailed { symbol: String, reason: String },
    OrderRejected(String),
    OrderTimeout(String),
    InvalidResponse(String),
    RateLimited { retry_after_ms: Option<u64> },
    NotConnected,
}
```

---

## Exchange-Specific Types

### Vest

```rust
pub struct VestConfig {
    pub primary_addr: String,    // Balance holder
    pub primary_key: String,     // Registration signer
    pub signing_key: String,     // Delegate signer
    pub account_group: u8,       // 0-9 server routing
    pub production: bool,
}

pub struct VestDepthData {
    pub bids: Vec<[String; 2]>,  // [price, qty]
    pub asks: Vec<[String; 2]>,
}
```

### Paradex

```rust
pub struct ParadexConfig {
    pub private_key: String,      // Starknet key
    pub account_address: String,  // Derived if not set
    pub production: bool,
}

pub struct ParadexOrderbookData {
    pub market: String,
    pub inserts: Vec<ParadexOrderbookLevel>,
    pub last_updated_at: u64,
    pub seq_no: u64,
}

pub struct ParadexOrderbookLevel {
    pub price: String,
    pub size: String,
    pub side: String,   // "BID" or "ASK"
}
```
